# Projects.py 리팩토링 실행 계획

## 📋 **프로젝트 개요**

**목표**: Projects.py 리팩토링을 기존과 100% 동일한 기능으로 완료
**현재 완성도**: 52%
**예상 소요 시간**: 4-7일
**우선순위**: Critical (Owner 권한 문제로 인한 서비스 영향)

## 🎯 **Phase 1: Critical Issues 해결 (1-2일)**

### **TASK_143: 프론트엔드 호환성 긴급 수정**

#### **Step 1.1: TypeScript 타입 정의 수정**
- [ ] `/web/src/types/index.ts` 수정
  - [ ] `Project` 인터페이스에 `user_role?: ProjectRole` 추가
  - [ ] `ProjectDetail` 인터페이스에 `user_role?: ProjectRole` 추가
  - [ ] `ProjectServer` 인터페이스 `disabled` → `is_enabled` 변경
  - [ ] 기타 관련 타입들 일괄 수정

#### **Step 1.2: ProjectStore Owner 권한 수정**
- [ ] `/web/src/stores/projectStore.ts` 수정
  - [ ] `loadProject` 함수에서 `project.user_role` 직접 사용
  - [ ] `isOwner`, `canEdit` 등 권한 체크 로직 수정
  - [ ] `project.members` 의존성 제거

#### **Step 1.3: 서버 관리 컴포넌트 수정**
- [ ] `/web/src/components/servers/` 디렉터리 전체 수정
  - [ ] `disabled` → `is_enabled` 필드명 변경
  - [ ] 로직 반전 처리 (`!disabled` → `is_enabled`)
  - [ ] 모든 관련 컴포넌트 일괄 적용

#### **Step 1.4: 프로젝트 설정 페이지 수정**
- [ ] `/web/src/app/projects/[projectId]/settings/page.tsx` 수정
  - [ ] Owner 권한 확인 로직 수정
  - [ ] "Read-only Mode" 조건 수정
  - [ ] 권한 기반 UI 렌더링 수정

#### **Step 1.5: 긴급 검증**
- [ ] Owner 로그인 후 프로젝트 설정 접근 테스트
- [ ] 서버 활성화/비활성화 기능 테스트
- [ ] 멤버 추가/제거 기능 테스트
- [ ] API 키 생성/삭제 기능 테스트

---

## 🔧 **Phase 2: 백엔드 안정화 (2-3일)**

### **TASK_144: API 엔드포인트 완전 검증**

#### **Step 2.1: 엔드포인트 매핑 검증**
- [ ] 기존 26개 vs 신규 34개 엔드포인트 전수 조사
  - [ ] `/api/projects` (GET) - 프로젝트 목록
  - [ ] `/api/projects` (POST) - 프로젝트 생성
  - [ ] `/api/projects/{id}` (GET) - 프로젝트 상세
  - [ ] `/api/projects/{id}` (PUT) - 프로젝트 수정
  - [ ] `/api/projects/{id}` (DELETE) - 프로젝트 삭제
  - [ ] `/api/projects/{id}/members` - 멤버 관리 (4개)
  - [ ] `/api/projects/{id}/servers` - 서버 관리 (8개)
  - [ ] `/api/projects/{id}/teams` - 팀 관리 (4개)
  - [ ] `/api/projects/{id}/favorites` - 즐겨찾기 (4개)
  - [ ] `/api/projects/{id}/api-keys` - API 키 관리 (3개)
  - [ ] 기타 유틸리티 엔드포인트들

#### **Step 2.2: 응답 형식 일치성 확보**
- [ ] 각 엔드포인트별 응답 형식 검증
  - [ ] Pydantic 모델 vs 프론트엔드 타입 비교
  - [ ] 필수 필드 누락 여부 확인
  - [ ] 데이터 타입 일치성 확인
  - [ ] 날짜/시간 형식 통일성 확인

#### **Step 2.3: 에러 처리 표준화**
- [ ] 모든 모듈에서 일관된 에러 응답
- [ ] HTTP 상태 코드 표준화
- [ ] 에러 메시지 국제화 적용
- [ ] 로깅 레벨 및 형식 통일

#### **Step 2.4: 권한 확인 로직 검증**
- [ ] 각 엔드포인트별 권한 확인 로직 테스트
  - [ ] Owner 권한 확인
  - [ ] Developer 권한 확인  
  - [ ] Viewer 권한 확인
  - [ ] 팀 멤버 권한 확인

---

## 🧹 **Phase 3: 정리 및 최적화 (1-2일)**

### **TASK_145: 코드 정리 및 최적화**

#### **Step 3.1: 기존 파일 완전 제거**
- [ ] `/src/mcp_orch/api/projects.py` (2,031줄) 백업 후 제거
- [ ] app.py에서 기존 라우터 import 제거
- [ ] 관련 주석 및 deprecated 코드 정리

#### **Step 3.2: Import 경로 최적화**
- [ ] 모든 모듈의 import 구조 최적화
- [ ] 순환 의존성 제거
- [ ] 불필요한 의존성 제거
- [ ] 상대/절대 경로 일관성 확보

#### **Step 3.3: 성능 최적화**
- [ ] 데이터베이스 쿼리 최적화
- [ ] N+1 쿼리 문제 해결
- [ ] 캐싱 전략 적용
- [ ] 응답 크기 최적화

#### **Step 3.4: 문서화 업데이트**
- [ ] API 문서 업데이트
- [ ] Swagger/OpenAPI 스펙 수정
- [ ] README 파일 업데이트
- [ ] 개발자 가이드 작성

---

## ✅ **Phase 4: 최종 검증 및 배포 (1일)**

### **TASK_146: 종합 검증 및 배포**

#### **Step 4.1: 전체 기능 테스트**
- [ ] **프로젝트 생명주기 테스트**
  - [ ] 프로젝트 생성 → 설정 → 멤버 추가 → 서버 추가 → 삭제
  - [ ] 권한별 접근 제어 테스트
  - [ ] 팀 초대 및 관리 테스트
  - [ ] API 키 생성 및 사용 테스트

- [ ] **성능 테스트**
  - [ ] 응답 시간 측정 (기존 대비)
  - [ ] 동시 접속 테스트
  - [ ] 메모리 사용량 모니터링
  - [ ] 데이터베이스 부하 테스트

- [ ] **호환성 테스트**
  - [ ] 다양한 브라우저 테스트
  - [ ] 모바일 반응형 테스트
  - [ ] API 클라이언트 호환성
  - [ ] 기존 데이터 마이그레이션 테스트

#### **Step 4.2: 보안 검증**
- [ ] 권한 우회 취약점 테스트
- [ ] SQL 인젝션 테스트
- [ ] XSS 방어 테스트
- [ ] CSRF 토큰 검증

#### **Step 4.3: 배포 준비**
- [ ] 마이그레이션 스크립트 준비
- [ ] 롤백 계획 수립
- [ ] 모니터링 대시보드 설정
- [ ] 알림 시스템 구성

#### **Step 4.4: 최종 배포**
- [ ] 스테이징 환경 배포
- [ ] 사용자 승인 테스트 (UAT)
- [ ] 프로덕션 배포
- [ ] 배포 후 모니터링

---

## 📊 **진행 상황 추적**

### **일별 마일스톤**

| 일차 | Phase | 주요 작업 | 완료율 목표 |
|------|-------|-----------|-------------|
| Day 1 | Phase 1 | 프론트엔드 긴급 수정 | 70% |
| Day 2 | Phase 1 | 백엔드 호환성 확보 | 85% |
| Day 3 | Phase 2 | API 검증 및 안정화 | 90% |
| Day 4 | Phase 2 | 에러 처리 표준화 | 95% |
| Day 5 | Phase 3 | 코드 정리 및 최적화 | 98% |
| Day 6 | Phase 4 | 종합 테스트 | 99% |
| Day 7 | Phase 4 | 최종 배포 | 100% |

### **위험 요소 및 대응 방안**

| 위험 요소 | 확률 | 영향도 | 대응 방안 |
|-----------|------|--------|-----------|
| 기존 데이터 호환성 문제 | 중간 | 높음 | 철저한 마이그레이션 테스트 |
| 성능 저하 | 낮음 | 중간 | 성능 벤치마크 및 최적화 |
| 권한 시스템 버그 | 중간 | 높음 | 단계별 권한 테스트 |
| 프론트엔드 타입 에러 | 높음 | 중간 | TypeScript 컴파일 검증 |

### **성공 지표**

#### **기술적 지표**
- [ ] TypeScript 컴파일 에러: 0개
- [ ] API 응답 시간: 기존 대비 ±10% 이내
- [ ] 테스트 커버리지: 90% 이상
- [ ] 코드 품질 점수: A 등급

#### **사용자 경험 지표**
- [ ] Owner 권한 정상 인식: 100%
- [ ] 기존 워크플로우 호환성: 100%
- [ ] 에러 발생률: 기존 대비 감소
- [ ] 사용자 만족도: 기존 수준 유지

---

## 🚨 **비상 계획**

### **롤백 시나리오**
1. **즉시 롤백**: 기존 `projects.py` 활성화
2. **부분 롤백**: 문제 모듈만 기존 버전 사용
3. **점진적 복구**: 모듈별 순차 수정

### **문제 해결 우선순위**
1. **Critical**: 권한 시스템 오류
2. **High**: API 응답 오류
3. **Medium**: 성능 저하
4. **Low**: UI/UX 개선점

---

**다음 문서**: 체크리스트 진행 상황 (`projects-refactoring-checklist.md`)